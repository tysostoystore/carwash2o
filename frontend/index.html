<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Запись на автомойку</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/808/808484.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .animate-fade-in {
      animation: fadeInScale .3s cubic-bezier(.4,0,.2,1);
    }
    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(.92); }
      100% { opacity: 1; transform: scale(1); }
    }
    .star {
      transition: transform .15s cubic-bezier(.4,0,.2,1), color .15s;
    }
    .star.animated {
      transform: scale(1.2) rotate(-6deg);
      color: #fb923c !important;
      text-shadow: 0 2px 8px #f9731644;
    }
    .btn-glow {
      box-shadow: 0 4px 24px 0 #f9731622, 0 1.5px 0 #fb923c;
      border: 1.5px solid #fb923c;
    }
    .modal-leave {
      animation: fadeOutScale .22s cubic-bezier(.4,0,.2,1) forwards;
    }
    @keyframes fadeOutScale {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(.96); }
    }
    .spinner {
      border: 2.5px solid #fff2;
      border-top: 2.5px solid #f97316;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      animation: spin .7s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center text-white">
  <div class="min-h-screen flex flex-col justify-between items-center w-full" style="background: linear-gradient(180deg, #23272f 0%, #18181b 100%);">
    <div class="w-full max-w-md mx-auto flex flex-col gap-8 py-8 px-4">
      <div class="flex flex-col items-center gap-2">
        <div class="w-32 h-32 rounded-full bg-[#18181b] flex items-center justify-center mb-2">
          <img src="/h2o_logo.png" alt="H2O logo" class="w-28 h-28 object-contain">
        </div>
        <div class="text-2xl font-extrabold text-white tracking-wide drop-shadow mb-1">H<sub class='text-base align-super text-[#f97316]'>2</sub>O <span class="text-base font-semibold text-gray-300 ml-1">автомойка 24/7</span></div>
        <div class="text-gray-400 text-base font-medium mb-2">Чисто. Быстро. Удобно.</div>
      </div>
      <button class="w-full py-3 rounded-xl bg-[#f97316] text-white text-lg font-semibold shadow-sm hover:bg-[#fb923c] active:scale-95 transition mb-2 btn-glow" id="main-booking-btn">Записаться на мойку</button>
      <button class="w-full py-3 rounded-xl bg-white text-gray-900 text-base font-medium shadow-sm hover:bg-gray-100 active:scale-95 transition mb-2 flex items-center justify-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 17.75l-6.172 3.243 1.179-6.873-5-4.873 6.9-1.002L12 2.25l3.093 6.995 6.9 1.002-5 4.873 1.179 6.873z"/></svg>
        Оставить отзыв
      </button>
      <a href="http://t.me/tysostoystore" target="_blank" rel="noopener noreferrer"
   class="w-full py-3 rounded-xl bg-white text-gray-900 text-base font-medium shadow-sm hover:bg-gray-100 active:scale-95 transition flex items-center justify-center gap-2 no-underline">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"/></svg>
  Связаться с оператором
</a>
    </div>
    <div class="w-full max-w-md mx-auto mb-6">
      <div class="bg-[#23272f] rounded-xl p-4 flex flex-col gap-2 text-white text-base font-medium">
        <div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7v5l3 2.5"/></svg> Работаем круглосуточно</div>
        <div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5A2.5 2.5 0 1 1 12 6a2.5 2.5 0 0 1 0 5.5z"/></svg> Санкт-Петербург, Кузнецовская 60</div>
        <div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#f97316] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 16.92v3a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 3.09 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.13.81.36 1.6.68 2.34a2 2 0 0 1-.45 2.11l-1.27 1.27a16.06 16.06 0 0 0 6.18 6.18l1.27-1.27a2 2 0 0 1 2.11-.45c.74.32 1.53.55 2.34.68A2 2 0 0 1 22 16.92z"/></svg> <a href="tel:+79669399000" class="text-[#f97316] underline hover:text-white transition">+7 (966) 939-90-00</a></div>
      </div>
    </div>
  </div>
  <!-- Review Modal (hidden by default) -->
  <div id="review-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm hidden">
    <div class="bg-[#23272f] rounded-2xl shadow-xl p-6 w-full max-w-sm mx-2 flex flex-col gap-4 relative animate-fade-in">
      <button id="close-review-modal" class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
      <div class="text-xl font-bold text-white mb-2">Оставить отзыв</div>
      <textarea class="w-full rounded-lg bg-gray-900 text-white p-3 resize-none focus:outline-none focus:ring-2 focus:ring-[#f97316]" rows="4" placeholder="Ваш отзыв..."></textarea>
      <div class="flex flex-col gap-2">
        <label class="text-gray-300 text-sm font-medium">Фото (необязательно):</label>
        <input type="file" accept="image/*" class="file:bg-[#f97316] file:text-white file:rounded file:px-3 file:py-1 file:border-0 file:mr-3 text-gray-200" />
      </div>
      <div class="flex flex-col gap-2">
        <label class="text-gray-300 text-sm font-medium">Оценка:</label>
        <div id="review-stars" class="flex gap-1 text-2xl cursor-pointer">
          <span data-star="1" class="star text-gray-500 hover:text-[#f97316]">★</span>
          <span data-star="2" class="star text-gray-500 hover:text-[#f97316]">★</span>
          <span data-star="3" class="star text-gray-500 hover:text-[#f97316]">★</span>
          <span data-star="4" class="star text-gray-500 hover:text-[#f97316]">★</span>
          <span data-star="5" class="star text-gray-500 hover:text-[#f97316]">★</span>
        </div>
      </div>
      <button class="w-full mt-2 py-3 rounded-xl bg-[#f97316] text-white text-lg font-semibold shadow-sm hover:bg-[#fb923c] active:scale-95 transition" id="review-send-btn">
        <span id="review-send-text">Отправить</span>
        <span id="review-send-spinner" class="spinner hidden"></span>
      </button>
    </div>
  </div>
  <script>
    // Modal logic
    const modal = document.getElementById('review-modal');
    const closeModal = document.getElementById('close-review-modal');
    const stars = document.querySelectorAll('#review-stars .star');
    let selectedRating = 0;
    // Open modal
    document.querySelectorAll('button').forEach(btn => {
      if (btn.textContent.trim() === 'Оставить отзыв') {
        btn.addEventListener('click', () => {
          modal.classList.remove('modal-leave');
          modal.classList.remove('hidden');
        });
      }
    });
    // Close modal (with animation)
    closeModal.addEventListener('click', () => {
      modal.classList.add('modal-leave');
      setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('modal-leave'); }, 220);
    });
    // Star rating logic + animation
    stars.forEach((star, idx) => {
      star.addEventListener('mouseenter', () => {
        stars.forEach((s, i) => s.classList.toggle('text-[#f97316]', i <= idx));
        star.classList.add('animated');
      });
      star.addEventListener('mouseleave', () => {
        stars.forEach((s, i) => s.classList.toggle('text-[#f97316]', i < selectedRating));
        stars.forEach((s, i) => s.classList.toggle('text-gray-500', i >= selectedRating));
        star.classList.remove('animated');
      });
      star.addEventListener('click', () => {
        selectedRating = idx + 1;
        stars.forEach((s, i) => {
          s.classList.toggle('text-[#f97316]', i < selectedRating);
          s.classList.toggle('text-gray-500', i >= selectedRating);
          s.classList.remove('animated');
        });
        star.classList.add('animated');
        setTimeout(() => star.classList.remove('animated'), 200);
      });
    });
    // Optional: Close on outside click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('modal-leave');
        setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('modal-leave'); }, 220);
      }
    });

    // Review send button loading state
    const reviewSendBtn = document.getElementById('review-send-btn');
    const reviewSendText = document.getElementById('review-send-text');
    const reviewSendSpinner = document.getElementById('review-send-spinner');
    reviewSendBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      reviewSendBtn.disabled = true;
      reviewSendText.classList.add('hidden');
      reviewSendSpinner.classList.remove('hidden');
      // Сбор данных
      const name = document.querySelector('#review-modal input[name="name"]')?.value || 'Гость';
      const text = document.querySelector('#review-modal textarea')?.value || '';
      const rating = selectedRating;
      const photoInput = document.querySelector('#review-modal input[type="file"]');
      let photo = '';
      // Простейший base64 encode (если фото выбрано)
      if (photoInput && photoInput.files && photoInput.files[0]) {
        const file = photoInput.files[0];
        const reader = new FileReader();
        reader.onload = async function(ev) {
          photo = ev.target.result;
          await sendReview({ name, rating, text, photo });
        };
        reader.readAsDataURL(file);
      } else {
        await sendReview({ name, rating, text, photo });
      }
    });

    async function sendReview(data) {
      const msg = document.getElementById('review-msg') || document.createElement('div');
      msg.id = 'review-msg';
      msg.className = 'text-center text-sm mt-2';
      reviewSendBtn.parentNode.insertBefore(msg, reviewSendBtn.nextSibling);
      if (!data.rating) {
        msg.textContent = 'Поставьте оценку';
        msg.className = 'text-red-400 text-center mt-2';
        reviewSendBtn.disabled = false;
        reviewSendText.classList.remove('hidden');
        reviewSendSpinner.classList.add('hidden');
        return;
      }
      try {
        const res = await fetch('https://carwash2o-production.up.railway.app/reviews', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          msg.textContent = 'Спасибо за отзыв!';
          msg.className = 'text-green-400 text-center mt-2';
          setTimeout(() => {
            modal.classList.add('modal-leave');
            setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('modal-leave'); }, 220);
            msg.textContent = '';
          }, 1200);
        } else {
          msg.textContent = result.error || 'Ошибка отправки';
          msg.className = 'text-red-400 text-center mt-2';
        }
      } catch {
        msg.textContent = 'Ошибка сервера';
        msg.className = 'text-red-400 text-center mt-2';
      }
      reviewSendBtn.disabled = false;
      reviewSendText.classList.remove('hidden');
      reviewSendSpinner.classList.add('hidden');
    }
  </script>
  <!-- Booking Modal (hidden by default) -->
  <div id="booking-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm hidden">
    <div class="bg-[#23272f] rounded-2xl shadow-xl p-6 w-full max-w-sm mx-2 flex flex-col gap-4 relative animate-fade-in">
      <button id="close-booking-modal" class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
      <div class="text-xl font-bold text-white mb-2">Запись на мойку</div>
      <form id="booking-form" class="flex flex-col gap-3">
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Услуга</label>
          <select class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="service">
            <option value="">Выберите услугу</option>
            <option>Экспресс-мойка</option>
            <option>Комплексная мойка</option>
            <option>Химчистка</option>
            <option>Полировка</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Дата</label>
          <select class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="date">
            <option value="">Выберите дату</option>
            <option>Сегодня</option>
            <option>Завтра</option>
            <option>31.07.2025</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Время</label>
          <select class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="time">
            <option value="">Выберите время</option>
            <option>10:00</option>
            <option>12:00</option>
            <option>14:00</option>
            <option>16:00</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Ваше имя</label>
          <input type="text" class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="name" placeholder="Имя" />
        </div>
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Телефон</label>
          <input type="tel" class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="phone" placeholder="+7 (___) ___-__-__" />
        </div>
        <div>
          <label class="block text-gray-300 text-sm font-medium mb-1">Модель авто</label>
          <input type="text" class="w-full rounded-lg bg-gray-900 text-white p-3 focus:outline-none focus:ring-2 focus:ring-[#f97316]" name="car" placeholder="Например, BMW X5" />
        </div>
        <button type="submit" class="w-full mt-2 py-3 rounded-xl bg-[#f97316] text-white text-lg font-semibold shadow-sm hover:bg-[#fb923c] active:scale-95 transition" id="booking-send-btn">
          <span id="booking-send-text">Записаться</span>
          <span id="booking-send-spinner" class="spinner hidden"></span>
        </button>
      </form>
    </div>
  </div>
  <script>
    // Booking modal logic
    const bookingModal = document.getElementById('booking-modal');
    const closeBookingModal = document.getElementById('close-booking-modal');
    // Open booking modal
    document.querySelectorAll('button').forEach(btn => {
      if (btn.textContent.trim() === 'Записаться на мойку') {
        btn.addEventListener('click', () => {
          bookingModal.classList.remove('modal-leave');
          bookingModal.classList.remove('hidden');
        });
      }
    });
    // Close booking modal (with animation)
    closeBookingModal.addEventListener('click', () => {
      bookingModal.classList.add('modal-leave');
      setTimeout(() => { bookingModal.classList.add('hidden'); bookingModal.classList.remove('modal-leave'); }, 220);
    });
    bookingModal.addEventListener('click', (e) => {
      if (e.target === bookingModal) {
        bookingModal.classList.add('modal-leave');
        setTimeout(() => { bookingModal.classList.add('hidden'); bookingModal.classList.remove('modal-leave'); }, 220);
      }
    });
    // Prevent form submit (stub) + loading spinner
    const bookingSendBtn = document.getElementById('booking-send-btn');
    const bookingSendText = document.getElementById('booking-send-text');
    const bookingSendSpinner = document.getElementById('booking-send-spinner');
    document.getElementById('booking-form').addEventListener('submit', e => {
      e.preventDefault();
      bookingSendBtn.disabled = true;
      bookingSendText.classList.add('hidden');
      bookingSendSpinner.classList.remove('hidden');
      setTimeout(() => {
        bookingSendBtn.disabled = false;
        bookingSendText.classList.remove('hidden');
        bookingSendSpinner.classList.add('hidden');
        bookingModal.classList.add('modal-leave');
        setTimeout(() => { bookingModal.classList.add('hidden'); bookingModal.classList.remove('modal-leave'); }, 220);
      }, 1200);
      // TODO: Wire up with variables and backend logic
    });
  </script>
</body>
</html>
